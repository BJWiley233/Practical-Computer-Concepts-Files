aws {
    accessKey = 'AKIARAB7E3QOHCBLNXOW'
    secretKey = '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'
    region = 'us-east-2'
    profile = '/home/coyote/.aws/config' 
    

    batch {
        shareIdentifier = 0
        volumes = ['/tmp:/tmp:rw']
    }

    client {
        maxConnections = 20
        connectionTimeout = 10000
        uploadStorageClass = 'INTELLIGENT_TIERING'
        storageEncryption = 'AES256'
        s3Acl = "BucketOwnerFullControl"
    }

}


//process.scratch = false
aws.batch.cliPath = '/home/ec2-user/miniconda/bin/aws'
docker {
    enabled = true
    temp = '/tmp'
}

cloud {
    // Amazon ECS-optimized Nextflow image with AWS cli
    //imageId = 'ami-06502972b2860f143'
    //imageID = 'ami-027bdac0d5c755ca7'
    imageID = 'ami-027bdac0d5c755ca7'
    //imageID = 'ami-09671395d0596bb30'
    instanceType = 'm5.large'
    //subnetId = 'subnet-00e6efd849093b92b'
    autoscale {
        enabled = true
        maxInstances = 2
        terminateWhenIdle = true
    }
}


plugins {
    id 'nf-amazon'
}

//process.executor = 'awsbatch'
//process.queue = 'test_queue_ec2'
// ec2_env_cr ; Compute environment
//process.memory = '4 GB'


process {
    withLabel: bcftools {
        executor = 'awsbatch'
        queue = 'small'
        container = 'kboltonlab/bst:2.0'
        memory = '4 GB'
    }

    withLabel: Sample_Alignment {
        executor = 'awsbatch'
        queue = 'cellranger'
        container = 'oandrefonseca/scaligners:1.0'
        memory = '114 GB'
    }

    withLabel: filter_vcf {
        executor = 'awsbatch'
        queue = 'test_queue_ec2'
        container = 'kboltonlab/bst:2.0'
    }
}

trace {
  enabled = true
  file = 'pipeline_trace.txt'
  overwrite = true
  fields = 'task_id,native_id,process,name,status,exit,submit,start,complete,duration,realtime,%cpu,%mem,rss'
}


weblog {
    enabled = true
    url = "http://localhost/nflogs"
}
